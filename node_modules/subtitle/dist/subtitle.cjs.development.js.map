{"version":3,"file":"subtitle.cjs.development.js","sources":["../src/filter.ts","../src/utils.ts","../src/formatTimestamp.ts","../src/map.ts","../src/Parser.ts","../src/parse.ts","../src/parseSync.ts","../src/parseTimestamp.ts","../src/parseTimestamps.ts","../src/resync.ts","../src/Formatter.ts","../src/stringify.ts","../src/stringifySync.ts"],"sourcesContent":["import { Node } from '.'\nimport { Transform } from 'readable-stream'\n\nexport const filter = (callback: (node: Node) => boolean) =>\n  new Transform({\n    objectMode: true,\n    transform: function transform(chunk, _encoding, next) {\n      callback(chunk) ? next(null, chunk) : next()\n    }\n  })\n","import { Duplex, DuplexOptions } from 'readable-stream'\n\nexport const padLeft = (value: number, length = 2): string =>\n  value.toString().padStart(length, '0')\n\nexport const createDuplex = (options: DuplexOptions) =>\n  new Duplex({\n    objectMode: true,\n    read() {},\n    ...options\n  })\n","import { padLeft } from './utils'\nimport { FormatOptions } from '.'\n\nexport function formatTimestamp(\n  timestamp: number,\n  options: FormatOptions = { format: 'SRT' }\n) {\n  const date = new Date(0, 0, 0, 0, 0, 0, timestamp)\n\n  const hours = date.getHours()\n  const minutes = date.getMinutes()\n  const seconds = date.getSeconds()\n  const ms = Math.floor(\n    timestamp - (hours * 3600000 + minutes * 60000 + seconds * 1000)\n  )\n\n  return `${padLeft(hours)}:${padLeft(minutes)}:${padLeft(seconds)}${\n    options.format === 'WebVTT' ? '.' : ','\n  }${padLeft(ms, 3)}`\n}\n","import { Transform } from 'readable-stream'\nimport { Node } from '.'\n\nexport const map = (mapper: (node: Node, index: number) => any) => {\n  let index = 0\n\n  return new Transform({\n    objectMode: true,\n    transform(chunk: Node, _encoding, callback) {\n      callback(null, mapper(chunk, index++))\n    }\n  })\n}\n","import stripBom from 'strip-bom'\nimport { Node, RE_TIMESTAMP, parseTimestamps } from '.'\n\nexport type Pusher = (node: Node) => void\n\nexport interface ParseState {\n  expect: 'header' | 'id' | 'timestamp' | 'text' | 'vtt_comment'\n  row: number\n  hasContentStarted: boolean\n  isWebVTT: boolean\n  node: Partial<Node>\n  buffer: string[]\n}\n\nexport class Parser {\n  private push: Pusher\n  private state: ParseState\n\n  constructor({ push }: { push: Pusher }) {\n    this.push = push\n    this.state = {\n      expect: 'header',\n      row: 0,\n      hasContentStarted: false,\n      isWebVTT: false,\n      node: {},\n      buffer: []\n    }\n  }\n\n  private isIndex(line: string): boolean {\n    return /^\\d+$/.test(line.trim())\n  }\n\n  private isTimestamp(line: string): boolean {\n    return RE_TIMESTAMP.test(line)\n  }\n\n  private isVttComment(line: string): boolean {\n    return /^NOTE/.test(line)\n  }\n\n  private getError(expected: string, index: number, row: string): Error {\n    return new Error(\n      `expected ${expected} at row ${index + 1}, but received: \"${row}\"`\n    )\n  }\n\n  public parseLine(line: string): void {\n    const contents = this.state.row === 0 ? stripBom(line) : line\n\n    if (!this.state.hasContentStarted) {\n      if (contents.trim()) {\n        this.state.hasContentStarted = true\n      } else {\n        return\n      }\n    }\n\n    const parse = {\n      header: this.parseHeader,\n      id: this.parseId,\n      timestamp: this.parseTimestamp,\n      text: this.parseText,\n      vtt_comment: this.parseVttComment\n    }[this.state.expect]\n\n    parse.call(this, contents)\n\n    this.state.row++\n  }\n\n  public flush(): void {\n    if (this.state.buffer.length > 0) {\n      this.pushNode()\n    }\n  }\n\n  private parseHeader(line: string) {\n    if (!this.state.isWebVTT) {\n      this.state.isWebVTT = /^WEBVTT/.test(line)\n\n      if (this.state.isWebVTT) {\n        this.state.node.type = 'header'\n      } else {\n        this.parseId(line)\n        return\n      }\n    }\n\n    this.state.buffer.push(line)\n\n    if (!line) {\n      this.state.expect = 'id'\n      return\n    }\n  }\n\n  private parseId(line: string) {\n    this.state.expect = 'timestamp'\n\n    if (this.state.node.type === 'header') {\n      this.pushNode()\n    }\n\n    if (this.isIndex(line)) return\n\n    if (this.state.isWebVTT && this.isVttComment(line)) {\n      this.state.expect = 'vtt_comment'\n      return\n    }\n\n    this.parseTimestamp(line)\n  }\n\n  private parseVttComment(line: string) {\n    this.state.expect = 'vtt_comment'\n\n    if (line.trim() === '') {\n      this.state.expect = 'id'\n    }\n  }\n\n  private parseTimestamp(line: string) {\n    if (!this.isTimestamp(line)) {\n      throw this.getError('timestamp', this.state.row, line)\n    }\n\n    this.state.node = {\n      type: 'cue',\n      data: {\n        ...parseTimestamps(line),\n        text: ''\n      }\n    }\n\n    this.state.expect = 'text'\n  }\n\n  private parseText(line: string) {\n    if (this.state.buffer.length === 0) {\n      this.state.buffer.push(line)\n      return\n    }\n\n    if (this.isTimestamp(line)) {\n      const lastIndex = this.state.buffer.length - 1\n\n      if (this.isIndex(this.state.buffer[lastIndex])) {\n        this.state.buffer.pop()\n      }\n\n      this.pushNode()\n      this.parseTimestamp(line)\n      return\n    }\n\n    if (this.isVttComment(line)) {\n      this.pushNode()\n      this.parseVttComment(line)\n      return\n    }\n\n    this.state.buffer.push(line)\n  }\n\n  private pushNode(): void {\n    if (this.state.node.type === 'cue') {\n      while (true) {\n        const lastItem = this.state.buffer[this.state.buffer.length - 1]\n        if (['', '\\n'].includes(lastItem)) {\n          this.state.buffer.pop()\n        } else {\n          break\n        }\n      }\n\n      while (true) {\n        const firstItem = this.state.buffer[0]\n        if (['', '\\n'].includes(firstItem)) {\n          this.state.buffer.shift()\n        } else {\n          break\n        }\n      }\n\n      this.state.node.data!.text = this.state.buffer.join('\\n')\n    }\n\n    if (this.state.node.type === 'header') {\n      this.state.node.data = this.state.buffer.join('\\n').trim()\n    }\n\n    this.push(this.state.node as Node)\n\n    this.state.node = {}\n    this.state.buffer = []\n  }\n}\n","import multipipe from 'multipipe'\nimport split2 from 'split2'\nimport { createDuplex } from './utils'\nimport { Parser } from './Parser'\n\nexport const parse = () => {\n  const parser = new Parser({\n    push: node => outputStream.push(node)\n  })\n\n  const stream = createDuplex({\n    write(chunk: object, _encoding: string, next: Function) {\n      try {\n        parser.parseLine(chunk.toString())\n      } catch (err) {\n        return next(err)\n      }\n\n      next()\n    }\n  })\n\n  const splitStream = split2()\n\n  splitStream.on('finish', () => {\n    parser.flush()\n    stream.push(null)\n  })\n\n  const outputStream = multipipe(splitStream, stream, {\n    objectMode: true\n  })\n\n  return outputStream\n}\n","import { Parser } from './Parser'\nimport { NodeList } from '.'\n\nexport const parseSync = (input: string): NodeList => {\n  const buffer: NodeList = []\n  const parser = new Parser({\n    push: node => buffer.push(node)\n  })\n\n  input\n    .replace(/\\r\\n/g, '\\n')\n    .split('\\n')\n    .forEach(line => parser.parseLine(line))\n\n  parser.flush()\n\n  return buffer\n}\n","export function parseTimestamp(timestamp: string): number {\n  const match = timestamp.match(\n    /^(?:(\\d{1,}):)?(\\d{1,2}):(\\d{1,2})[,.](\\d{1,3})$/\n  )\n\n  if (!match) {\n    throw new Error('Invalid SRT or VTT time format: \"' + timestamp + '\"')\n  }\n\n  const hours = match[1] ? parseInt(match[1], 10) * 3600000 : 0\n  const minutes = parseInt(match[2], 10) * 60000\n  const seconds = parseInt(match[3], 10) * 1000\n  const milliseconds = parseInt(match[4], 10)\n\n  return hours + minutes + seconds + milliseconds\n}\n","import { parseTimestamp, Timestamp } from '.'\n\nexport const RE_TIMESTAMP = /^((?:\\d{1,}:)?\\d{1,2}:\\d{1,2}[,.]\\d{1,3}) --> ((?:\\d{1,}:)?\\d{1,2}:\\d{1,2}[,.]\\d{1,3})(?: (.*))?$/\n\nexport function parseTimestamps(value: string): Timestamp {\n  const match = RE_TIMESTAMP.exec(value)\n\n  if (!match) {\n    throw new Error('Invalid timestamp format')\n  }\n\n  const timestamp: Timestamp = {\n    start: parseTimestamp(match[1]),\n    end: parseTimestamp(match[2])\n  }\n\n  if (match[3]) {\n    timestamp.settings = match[3]\n  }\n\n  return timestamp\n}\n","import { map, Node } from '.'\n\nexport const resync = (time: number) =>\n  map((node: Node) => {\n    if (node.type === 'cue') {\n      return {\n        ...node,\n        data: {\n          ...node.data,\n          start: node.data.start + time,\n          end: node.data.end + time\n        }\n      }\n    }\n\n    return node\n  })\n","import { FormatOptions, Node, Cue, formatTimestamp } from '.'\n\nexport class Formatter {\n  private options: FormatOptions\n  private isVTT: boolean\n  private hasReceivedHeader: boolean\n  private index: number\n\n  constructor(options: FormatOptions) {\n    this.options = options\n    this.hasReceivedHeader = false\n    this.isVTT = options.format === 'WebVTT'\n    this.index = 1\n  }\n\n  public format(node: Node): string {\n    let buffer = ''\n\n    if (node.type === 'header' && this.isVTT) {\n      this.hasReceivedHeader = true\n      buffer += `${node.data}\\n\\n`\n    }\n\n    if (node.type === 'cue') {\n      if (!this.hasReceivedHeader && this.isVTT) {\n        this.hasReceivedHeader = true\n        buffer += 'WEBVTT\\n\\n'\n      }\n\n      buffer += this.formatCue(node.data, this.index++, this.options)\n    }\n\n    return buffer\n  }\n\n  private formatCue(cue: Cue, index: number, options: FormatOptions) {\n    return [\n      `${index > 1 ? '\\n' : ''}${index}`,\n      `${formatTimestamp(cue.start, options)} --> ${formatTimestamp(\n        cue.end,\n        options\n      )}${\n        options.format === 'WebVTT' && cue.settings ? ' ' + cue.settings : ''\n      }`,\n      cue.text,\n      ''\n    ].join('\\n')\n  }\n}\n","import { map, FormatOptions, Node } from '.'\nimport { Formatter } from './Formatter'\n\nexport const stringify = (options: FormatOptions) => {\n  const formatter = new Formatter(options)\n  return map((chunk: Node) => formatter.format(chunk))\n}\n","import { NodeList, FormatOptions } from '.'\nimport { Formatter } from './Formatter'\n\nexport const stringifySync = (\n  list: NodeList,\n  options: FormatOptions\n): string => {\n  const formatter = new Formatter(options)\n\n  return list.reduce((buffer, node) => {\n    return buffer + formatter.format(node)\n  }, '')\n}\n"],"names":["filter","callback","Transform","objectMode","transform","chunk","_encoding","next","padLeft","value","length","toString","padStart","createDuplex","options","Duplex","read","formatTimestamp","timestamp","format","date","Date","hours","getHours","minutes","getMinutes","seconds","getSeconds","ms","Math","floor","map","mapper","index","Parser","push","state","expect","row","hasContentStarted","isWebVTT","node","buffer","isIndex","line","test","trim","isTimestamp","RE_TIMESTAMP","isVttComment","getError","expected","Error","parseLine","contents","stripBom","parse","header","parseHeader","id","parseId","parseTimestamp","text","parseText","vtt_comment","parseVttComment","call","flush","pushNode","type","data","parseTimestamps","lastIndex","pop","lastItem","includes","firstItem","shift","join","parser","outputStream","stream","write","err","splitStream","split2","on","multipipe","parseSync","input","replace","split","forEach","match","parseInt","milliseconds","exec","start","end","settings","resync","time","Formatter","hasReceivedHeader","isVTT","formatCue","cue","stringify","formatter","stringifySync","list","reduce"],"mappings":"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"}